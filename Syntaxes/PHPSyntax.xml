<?xml version="1.0" encoding="UTF-8"?>

<!-- PHP Syntax Sugar version  -->

<syntax name="sourcecode.php">
	<zones>
		<!-- PHP Source Block; <?php ... ?> -->
		<zone name="source.block.php">
			<starts-with>
				<expression>(((&lt;=\?>)&lt;)|&lt;)\?(?i:php|=)?</expression>
				<capture number="0" name="begin.php" />
				<capture number="1" name="punctuation.begin.php" />
			</starts-with>
			<ends-with>
				<expression>(\?)</expression>
				<capture number="0" name="end.php" />
			</ends-with>
			<subzones>
				<include collection="functions" />
				<include collection="variables" />
				<include collection="meta" />
			</subzones>
		</zone>
	</zones>
	
	<library>
		<!-- Classes -->
		<collection name="functions">
			<!-- Class definition; class className { ... } -->
			<zone name="meta.class.php">
					<expression>\b(class)\s+([a-zA-Z_$]\w*)</expression>
					<capture number="2" name="entity.name.function.php" />
					<capture number="1" name="storage.type.function.php" />
					<capture number="3" name="punctuation.definition.parameters.begin"/>
					<capture number="4" name="variable.parameter.function.php"/>
					<capture number="5" name="punctuation.definition.parameters.end"/>
				<subzones>
					<include collection="variables" />
					<include collection="functions" />
				</subzones>
			</zone>
			<!-- Custom Function Call; funName(); -->
			<zone name="meta.function-call.php">
                <expression>[A-Za-z_][A-Za-z_0-9]*(?=\s*\()</expression>
           </zone>
		</collection>
		
		<!-- Functions -->
		<collection name="functions">
			<!-- Function definition; function funName() { ... } -->
			<zone name="meta.function.php">
					<expression>\b(function)\s+([a-zA-Z_$]\w*)?\s*(\()(.*?)(\))</expression>
					<capture number="2" name="entity.name.function.php" />
					<capture number="1" name="storage.type.function.php" />
					<capture number="3" name="punctuation.definition.parameters.begin"/>
					<capture number="4" name="variable.parameter.function.php"/>
					<capture number="5" name="punctuation.definition.parameters.end"/>
				<subzones>
					<include collection="variables" />
					<include collection="functions" />
				</subzones>
			</zone>
			<!-- Custom Function Call; funName(); -->
			<zone name="meta.function-call.php">
                <expression>[A-Za-z_][A-Za-z_0-9]*(?=\s*\()</expression>
           </zone>
		</collection>
		
		<!-- Arrays -->
		<collection name="arrays">
			<!-- array(); -->
			<zone name="meta.array.php">
                <starts-with>
                    <expression>(array)\s*(?=\s*)(\()(.*?)(\))</expression>
                    <capture number="1" name="support.array.construct.php"/>
                    <capture number="3" name="punctuation.definition.array.begin.php"/>
                    <capture number="4" name="punctuation.definition.array.begin.php"/>
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="punctuation.definition.array.end.php"/>
                </ends-with>
                <subzones>
					<include collection="string-single-quoted" />
					<include syntax="self" />
                </subzones>
            </zone>
		</collection>
		
		<!-- Variables -->
		<collection name="variables">
			<!-- Variable Name; $variableName -->
			<zone name="meta.name.variable.php">
				<expression>(?x)(\$+)[a-zA-Z_\x{7f}-\x{ff}][a-zA-Z0-9_\x{7f}-\x{ff}]*?\b</expression>
			</zone>
			<subzones>
				<include collection="arrays" />
			</subzones>
		</collection>
		
				
		<!-- Strings; I as thinking of breaking up single quotes and double quotes in to their own 
			  collection to mimi the built in HTML and XML Sugar. -->
		<collection name="string-double-quoted">
			<zone name="string.quoted.double.php">
				<starts-with>
					<expression>"</expression>
					<capture number="0" name="punctuation.definition.string.begin.php"/>
				</starts-with>
				<ends-with>
					<expression>"</expression>
					<capture number="0" name="punctuation.definition.string.end.php"/>
				</ends-with>
				<subzones name="meta.string-contents.quoted.double.php">
					<include collection="interpolation"/>
				</subzones>
			</zone>
		</collection>
		
		<collection name="meta">
			<!-- Open Curly Brace -->
			<zone name="meta.brace.curly.open.php">
	       	<expression>\{</expression>
	       </zone>
	       <!-- Close Curly Brace -->
			<zone name="meta.brace.curly.close.php">
	       	<expression>\}</expression>
	       </zone>
			<zone name="meta.brace.round.js">
				<expression>\(|\)</expression>
			</zone>
		</collection>
		
	</library>
</syntax>
